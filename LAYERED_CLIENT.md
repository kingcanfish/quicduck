# 分层QUIC客户端

这是一个重构后的QUIC客户端，采用三层架构设计：

## 架构设计

### 🎯 应用层 (Application Layer)
- **职责**: 处理用户交互终端，接收用户输入
- **通信**: 通过channel与QUIC层双向通信
- **功能**: 
  - 启动交互终端接收用户输入
  - 发送用户消息到QUIC层
  - 接收并显示来自服务器的消息

### 🔗 QUIC层 (QUIC Layer) 
- **职责**: 处理QUIC协议逻辑，管理连接状态
- **通信**: 通过channel与应用层和UDP层双向通信
- **功能**:
  - 处理QUIC连接管理
  - 流数据的发送和接收
  - 连接保活和错误处理
  - 数据包的组装和解析

### 🌐 UDP层 (UDP Layer)
- **职责**: 处理网络数据包的收发
- **通信**: 通过channel与QUIC层双向通信
- **功能**:
  - UDP套接字管理
  - 网络数据包的发送和接收
  - 网络错误处理

## 消息流

### 发送消息流程
```
用户输入 → 应用层 → [Channel] → QUIC层 → [Channel] → UDP层 → 网络
```

### 接收消息流程
```
网络 → UDP层 → [Channel] → QUIC层 → [Channel] → 应用层 → 显示给用户
```

## 使用方法

### 1. 启动服务器
```bash
cargo run --bin server
```

### 2. 启动分层客户端
```bash
cargo run --bin client_layered
```

### 3. 使用客户端
- 在终端中输入消息，按回车发送
- 输入 `quit` 退出客户端
- 服务器回复的消息会实时显示

## 特性

✨ **清晰的层次分离** - 每层职责明确，便于维护和扩展
🔄 **异步通信** - 层间通过channel异步通信，性能优异
🛡️ **错误隔离** - 各层独立处理错误，提高系统稳定性
📊 **易于调试** - 每层都有详细的日志输出

## 日志级别

可以通过环境变量控制日志级别：

```bash
# 详细调试信息
RUST_LOG=debug cargo run --bin client_layered

# 基本信息（默认）
RUST_LOG=info cargo run --bin client_layered

# 只显示错误
RUST_LOG=error cargo run --bin client_layered
```

## 架构优势

1. **模块化设计**: 每层功能独立，易于测试和维护
2. **可扩展性**: 可以轻松替换或扩展某一层的功能
3. **并发性**: 各层并行运行，提高整体性能
4. **可观测性**: 每层都有清晰的日志输出，便于问题定位
